{% extends "CFUserBundle::layout.html.twig" %}

{% block title %}
	{{ parent() }} - Profil utilisateur
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link href="{{ asset('css/style_profile.css') }}" rel="stylesheet"/>
{% endblock %}

{% block body %}
	<div class="panel-heading">
		<img src="{{ asset('images/6.jpg')}}" id="banner"/>
		<div class="logo-name">
			{% if user.typeUser == 'Particulier' and user.benevole %}
				<p id='label'>Bénévole <i class="fa fa-check"></i></p>
			{% elseif user.typeUser == 'Association' and user.certified %}
				<p id='label'>Association certifiée <i class="fa fa-check"></i></p>
			{% elseif user.typeUser == 'Entreprise' and user.certified %}
				<p id='label'>Entreprise certifiée <i class="fa fa-check"></i></p>
			{% else %}
				<p id='label' style="visibility: hidden;">Blank</p>
			{% endif %}
			<img id='logo' class="img-circle" src="{{asset( user.logo.AssetPath )}}" alt="Logo" />
			<div class="logo-username">
				<h1>{{ user.nom }}</h1>
				<h2>
					{% if (user.typeUser == "Particulier") and user.benevole %}
						Bénévole
					{% else %}
						{{ user.typeUser }}
					{% endif %}
				</h2>
			</div>
		</div>
	</div>
	<div class="content-panel-heading">
		<ul class="nav nav-tabs btn-group" role='group'>
			<li class="btn btn-default active"><a href="#tab1" data-toggle="tab">Général</a></li>
			<li class="btn btn-default"><a href="#tab2" data-toggle="tab">Badges</a></li>
			<li class="btn btn-default"><a href="#tab3" data-toggle="tab">Projets soutenus</a></li>
			{% if user.typeUser == "Association" %}
				<li class="btn btn-default"><a href="#tab4" data-toggle="tab">Projets proposés</a></li>
			{% endif %}
			{% if is_granted('IS_AUTHENTICATED_REMEMBERED') and user.username == app.user.username %}
				<li class="btn btn-default"><a href="{{ path('fos_user_profile_edit') }}">Paramètres</a></li>
			{% endif %}
		</ul>
	</div>
	<div class="panel-body">
		<div class="tab-content">
			<div class="tab-pane fade in active" id="tab1">
				<div class="tab-box">
					<h1>Description</h1>
					{% if user.typeUser == 'Association' %}
						<p>Date de création : {{ user.dateCreationAsso|date("d/m/Y") }}</p>
						<p>N° WALDEC : {{ user.numWaldec }}</p>
						<p>{{ user.descriptionAsso }}</p>
					{% elseif user.typeUser == 'Entreprise' %}
						<p>Date de création : {{ user.dateCreationEntreprise|date("d/m/Y") }}</p>
						<p>N° SIRET : {{ user.numSiret }}</p>
					{% elseif user.typeUser == 'Particulier' or user.typeUser == 'Bénévole' %}
						<p>Nom : {{ user.name }}</p>
						<p>Prénom : {{ user.firstname }}</p>
						<p>Date de naissance : {{ user.dateNaissance|date("d/m/Y") }}</p>
						<p>Bénévole : {% if user.benevole %}Oui{% else %}Non{% endif %}</p>
						<p>Ville : {{ user.ville }}</p>
					{% endif %}
				</div>
				<div class="tab-box">
					<h1>Informations</h1>
				  	<table class="table">
				        <tbody>
				        	{% if user.site %}
								<tr><td>Site web :</td><td><a href="{{ user.site }}" target="_blank">{{ user.site }}</a></td></tr>
							{% endif %}
							{% if user.facebook or user.twitter or user.googleplus %}
								<tr><td>Réseaux sociaux :</td>
									<td>
										{% if user.facebook %}
											<a href="http://www.facebook.com/{{ user.facebook }}" id="facebook" target="_blank"><span class="fa fa-facebook"></span> Facebook</a><br>
										{% endif %}
										{% if user.twitter %}
											<a href="http://www.twitter.com/{{ user.twitter }}" id="twitter" target="_blank"><span class="fa fa-twitter"></span> Twitter</a><br>
										{% endif %}
										{% if user.googleplus %}
											<a href="http://plus.google.com/{{ user.googleplus }}" id="googleplus" target="_blank"><span class="fa fa-google-plus"></span> Google+</a>
										{% endif %}
									</td>
								</tr>
							{% endif %}
							<tr><td>Adresse Email :</td><td><a href="mailto:{{ user.email }}">{{ user.email }}</a></td></tr>
							{% set phone = user.telephone|split('', 2) %}
							{% set phoneNb = "" %}
							{% for number in phone %}
								{% set phoneNb = phoneNb ~ number ~ '.' %}
							{% endfor %}
							<tr><td>Tél. :</td><td>{{ phoneNb|trim('.') }}</td></tr>
				        </tbody>
				    </table>
				</div>
				{% if user.typeUser == 'Association' or user.typeUser == 'Entreprise' %}
					<div class="tab-box full">
						<h1><i class="fa fa-map-marker"></i> Adresse</h1>
						<div class="inner-left">
					      	<table class="table">
					            <tbody>
									<tr><td>Ville :</td><td>{{ user.ville }}</td></tr>
									<tr><td>CP :</td><td>{{ user.cp }}</td></tr>
									<tr><td>Adresse :</td><td>{{ user.adresse }}</td></tr>
					            </tbody>
					    	</table>
						</div>
						<div class="inner-right">
							<img src="{{ asset('images/google-map.jpg') }}"  class="center-block" />
						</div>
					</div>
				{% endif %}
			</div>
			<div class="tab-pane fade" id="tab2">
				<div class="tab-box full">
					<h1>Badges</h1>
					{% for b in user.badges %}
						<div class="badge-profil">
							<div class="titre badge">{{ b.titre }}</div>
							<span data-toggle="tooltip" data-placement="bottom" title="{{ b.description }}">
								<img src="{{ asset(b.image.AssetPath) }}" alt="{{ b.titre }}" />
							</span>
						</div>
					{% else %}
						<p>Aucun badge... Pour le moment !</p>
					{% endfor %}
				</div>
			</div>
			<div class="tab-pane fade" id="tab3">
				<div class="tab-box full">
					<h1>Projets soutenus</h1>
					<div class="project-list">
						{% for projet in user.projetsSoutenus %}
							<div class="project" id="project-{{ projet.id }}">
								<div class="project-background" img="{{ projet.background.path }}"></div>
								<p><a href="{{ path('cf_main_project', { 'slug' : projet.slug }) }}">{{ projet.nom }}</a></p>
								{% set pourcentage = (projet.nbActuHumain + projet.nbActuMateriel + projet.nbActuComm + projet.nbActuFinancier)/projet.nbRessources %}
								<div class='percentage'>Complété à {{ (pourcentage*100)|round }}%</div>
								<div class="time-remaining">
									<i class="fa fa-clock-o"></i> 
									{% set difference = projet.dateFin.diff(date('now')) %}
									{% set leftDays = difference.days %}
									{% set leftHours = difference.h %}
									{% set leftMinutes = difference.i %}
									{% if projet.dateFin > date('now') %}
										{% if leftDays > 1 %}
											{{ leftDays }} jours
										{% elseif leftDays == 1 %}
											{{ leftDays }} jour
										{% else %}
											{% if leftHours > 1 %}
												{{ leftHours }} heures
											{% elseif leftHours == 1 %}
												{{ leftHours }} heure
											{% else %}
												{% if leftMinutes > 0 %}
													{{ leftMinutes }} minutes
												{% endif %}
											{% endif %}
										{% endif %}
									{% else %}
										Projet terminé
									{% endif %}
								</div>
							</div>
						{% else %}
							<p>Aucun projet soutenu pour l'instant.</p>
						{% endfor %}
					</div>
				</div>
			</div>
			{% if user.typeUser == 'Association' %}
				<div class="tab-pane fade" id="tab4">
					<div class="tab-box full">
						<h1>Projets proposés</h1>
						<div class="project-list">
							{% for projet in projets %}
								<div class="project" id="project-{{ projet.id }}">
									<div class="project-background" img="{{ projet.background.path }}"></div>
									<p><a href="{{ path('cf_main_project', { 'slug' : projet.slug }) }}">{{ projet.nom }}</a></p>
									{% set pourcentage = (projet.nbActuHumain + projet.nbActuMateriel + projet.nbActuComm + projet.nbActuFinancier)/projet.nbRessources %}
									<div class='percentage'>Complété à {{ (pourcentage*100)|round }}%</div>
									<div class="time-remaining">
										<i class="fa fa-clock-o"></i> 
										{% set difference = projet.dateFin.diff(date('now')) %}
										{% set leftDays = difference.days %}
										{% set leftHours = difference.h %}
										{% set leftMinutes = difference.i %}
										{% if projet.dateFin > date('now') %}
											{% if leftDays > 1 %}
												{{ leftDays }} jours
											{% elseif leftDays == 1 %}
												{{ leftDays }} jour
											{% else %}
												{% if leftHours > 1 %}
													{{ leftHours }} heures
												{% elseif leftHours == 1 %}
													{{ leftHours }} heure
												{% else %}
													{% if leftMinutes > 0 %}
														{{ leftMinutes }} minutes
													{% endif %}
												{% endif %}
											{% endif %}
										{% else %}
											Projet terminé
										{% endif %}
									</div>
								</div>
							{% else %}
								<p>Aucun projet proposé pour l'instant.</p>
							{% endfor %}
						</div>
					</div>
				</div>
			{% endif %}
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{parent()}}
	<script type="text/javascript">
		{% for projet in projets %}
			var img = $('#project-{{ projet.id }}').children('.project-background').attr('img');
			$('#project-{{ projet.id }}').children('.project-background').css('background', 'url("../../../uploads/'+img+'") center center no-repeat').css('background-size','cover');
		{% endfor %}
		{% for projet in user.projetsSoutenus %}
			var img = $('#project-{{ projet.id }}').children('.project-background').attr('img');
			$('#project-{{ projet.id }}').children('.project-background').css('background', 'url("../../../uploads/'+img+'") center center no-repeat').css('background-size','cover');
		{% endfor %}
	</script>
{% endblock %}