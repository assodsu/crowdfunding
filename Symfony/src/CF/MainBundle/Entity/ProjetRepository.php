<?php

namespace CF\MainBundle\Entity;

/**
 * ProjetAccueilRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ProjetRepository extends \Doctrine\ORM\EntityRepository
{
    public function getUnique($projet) {
        $qb = $this->createQueryBuilder('p');
         
        $qb->join('p.boxs', 'b')
           ->where('p.id = :idProjet')
           ->setParameter('idProjet', $projet->getId())
          // ->orderBy('b.ordre', 'DESC')
           ;
                 
        return $qb->getQuery()->getSingleResult();
    }

	public function getProjetsAboutissants()
    {  
        $qb = $this->createQueryBuilder('p');
         
        $qb->orderBy('p.dateFin', 'ASC')
           ->setMaxResults(10);
                 
        return $qb->getQuery()->getResult();
    }

    public function getProjetsNouveaux()
    {  
        $qb = $this->createQueryBuilder('p');
         
        $qb->orderBy('p.dateCreation', 'DESC')
           ->setMaxResults(10);
                 
        return $qb->getQuery()->getResult();
    }

	public function getSearchList($motcle)
    {  
        $qb = $this->createQueryBuilder('p');
         
        $qb->leftJoin('p.idAsso', 'a')
            ->leftJoin('p.tags', 't')
        	->where('p.nom LIKE :motcle')
        	->orWhere('a.ville LIKE :motcle')
            ->orWhere('t.nom LIKE :motcle')
            ->setParameter('motcle', '%'.$motcle.'%');
                 
        return $qb->getQuery()->getResult();
    }
}